# Architecture Diagrams

<!-- Generated by Copilot -->

> Visual overview of the TransactionService architecture

## System Context

```
┌─────────────────────────────────────────────────────────────────┐
│                      ExpenseVault Ecosystem                      │
│                                                                  │
│  ┌──────────────┐    ┌──────────────────────────────────────┐   │
│  │   Frontend   │───▶│      TransactionService (9400)       │   │
│  │   (Web/App)  │    │                                      │   │
│  └──────────────┘    │  ┌────────────┐  ┌────────────────┐  │   │
│                      │  │ PostgreSQL │  │     Redis      │  │   │
│                      │  │   (5432)   │  │    (6379)      │  │   │
│                      │  └────────────┘  └────────────────┘  │   │
│                      └──────────────────────────────────────┘   │
│                                                                  │
│  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐       │
│  │WalletService │    │ UserService  │    │CategoryService│       │
│  └──────────────┘    └──────────────┘    └──────────────┘       │
└─────────────────────────────────────────────────────────────────┘
```

## Clean Architecture Layers

```
┌─────────────────────────────────────────────────────────────────┐
│                                                                  │
│                          API Layer                               │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │  FastEndpoints  │  Middleware  │  Program.cs            │   │
│   └─────────────────────────────────────────────────────────┘   │
│                              │                                   │
│                              ▼                                   │
│                      Application Layer                           │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │  Commands  │  Queries  │  DTOs  │  Validators           │   │
│   └─────────────────────────────────────────────────────────┘   │
│                              │                                   │
│                              ▼                                   │
│                    Infrastructure Layer                          │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │  DbContext  │  EF Configs  │  Migrations  │  Caching    │   │
│   └─────────────────────────────────────────────────────────┘   │
│                              │                                   │
│                              ▼                                   │
│                        Domain Layer                              │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │  Entities  │  Value Objects  │  Enums  │  Domain Logic  │   │
│   └─────────────────────────────────────────────────────────┘   │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## Domain Model

```
┌─────────────────────────────────────────────────────────────────┐
│                         Transaction                              │
│                      (Aggregate Root)                            │
├─────────────────────────────────────────────────────────────────┤
│  Id: Guid                                                        │
│  WalletId: Guid                                                  │
│  CategoryId: Guid                                                │
│  Amount: Money ─────────────────┐                                │
│  Type: TransactionType          │                                │
│  Description: string            │    ┌─────────────────────┐    │
│  TransactionDate: DateTimeOffset│    │       Money         │    │
│  Notes: string?                 │    ├─────────────────────┤    │
│  Location: Location? ───────────┼───▶│  Amount: decimal    │    │
│  Tags: List<string>             │    │  Currency: string   │    │
│  Attachments ───────────────────┼─┐  └─────────────────────┘    │
│  CreatedAt: DateTimeOffset      │ │                              │
│  UpdatedAt: DateTimeOffset?     │ │  ┌─────────────────────┐    │
└─────────────────────────────────┼─┼──│      Location       │    │
                                  │ │  ├─────────────────────┤    │
                                  │ │  │  Latitude: double   │    │
┌─────────────────────────────────┼─┼──│  Longitude: double  │    │
│      TransactionAttachment      │ │  │  Address: string?   │    │
├─────────────────────────────────┤ │  └─────────────────────┘    │
│  Id: Guid                       │◀┘                              │
│  TransactionId: Guid            │                                │
│  FileName: string               │                                │
│  FilePath: string               │                                │
│  AttachmentType: AttachmentType │                                │
│  FileSize: long                 │                                │
└─────────────────────────────────┘                                │
                                                                   │
┌─────────────────────────────────┐                                │
│     RecurringTransaction        │                                │
├─────────────────────────────────┤                                │
│  Id: Guid                       │                                │
│  SourceTransactionId: Guid ─────┼────────────────────────────────┘
│  Frequency: RecurrenceFrequency │
│  NextOccurrence: DateTimeOffset │
│  EndDate: DateTimeOffset?       │
│  IsActive: bool                 │
└─────────────────────────────────┘
```

## CQRS Flow

```
                    ┌─────────────────┐
                    │   HTTP Request  │
                    └────────┬────────┘
                             │
                             ▼
                    ┌─────────────────┐
                    │   FastEndpoint  │
                    └────────┬────────┘
                             │
              ┌──────────────┴──────────────┐
              │                             │
              ▼                             ▼
     ┌────────────────┐           ┌────────────────┐
     │    Command     │           │     Query      │
     │   (Write Op)   │           │   (Read Op)    │
     └────────┬───────┘           └────────┬───────┘
              │                             │
              ▼                             ▼
     ┌────────────────┐           ┌────────────────┐
     │    MediatR     │           │    MediatR     │
     │   Pipeline     │           │   Pipeline     │
     └────────┬───────┘           └────────┬───────┘
              │                             │
              ▼                             ▼
     ┌────────────────┐           ┌────────────────┐
     │    Handler     │           │    Handler     │
     │ (Domain Logic) │           │ (Read from DB) │
     └────────┬───────┘           └────────┬───────┘
              │                             │
              ▼                             ▼
     ┌────────────────┐           ┌────────────────┐
     │   DbContext    │           │  HybridCache   │
     │ (SaveChanges)  │           │  (L1 + Redis)  │
     └────────────────┘           └────────────────┘
```

## Caching Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                        Application                               │
│                             │                                    │
│                             ▼                                    │
│                    ┌─────────────────┐                          │
│                    │   HybridCache   │                          │
│                    └────────┬────────┘                          │
│                             │                                    │
│              ┌──────────────┴──────────────┐                    │
│              │                             │                    │
│              ▼                             ▼                    │
│     ┌─────────────────┐           ┌─────────────────┐          │
│     │   L1 Cache      │           │   L2 Cache      │          │
│     │  (In-Memory)    │           │    (Redis)      │          │
│     │                 │           │                 │          │
│     │  Fast access    │           │  Distributed    │          │
│     │  Limited size   │           │  Persistent     │          │
│     │  Per-instance   │           │  Shared         │          │
│     └─────────────────┘           └─────────────────┘          │
│                                                                  │
│     Cache Key Pattern: "transaction:{id}"                        │
│     Default TTL: 5 minutes                                       │
└─────────────────────────────────────────────────────────────────┘
```

## Database Schema (Future Partitioning)

```
┌─────────────────────────────────────────────────────────────────┐
│                    transactions (Partitioned)                    │
├─────────────────────────────────────────────────────────────────┤
│  PARTITION BY RANGE (transaction_date)                          │
│                                                                  │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │  transactions_2025_q1  │  2025-01-01 to 2025-03-31        │  │
│  ├───────────────────────────────────────────────────────────┤  │
│  │  transactions_2025_q2  │  2025-04-01 to 2025-06-30        │  │
│  ├───────────────────────────────────────────────────────────┤  │
│  │  transactions_2025_q3  │  2025-07-01 to 2025-09-30        │  │
│  ├───────────────────────────────────────────────────────────┤  │
│  │  transactions_2025_q4  │  2025-10-01 to 2025-12-31        │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                  │
│  Managed by: pg_partman (automatic partition creation)           │
│  Retention: Configurable (default: indefinite)                   │
└─────────────────────────────────────────────────────────────────┘
```

---

**Navigation**: [Explanation Home](../README.md) | [Documentation Map](../../DOCUMENTATION_MAP.md)
