# Transaction Guide

<!-- Generated by Copilot -->

> Domain concepts and workflows for the TransactionService

## What is a Transaction?

A **Transaction** represents a financial activity - money coming in (income), going out (expense), or moving between accounts (transfer).

## Transaction Types

| Type | Value | Description | Example |
|------|-------|-------------|---------|
| Income | 0 | Money received | Salary, refund, gift |
| Expense | 1 | Money spent | Purchase, bill, subscription |
| Transfer | 2 | Money moved between wallets | Savings to checking |

## Core Concepts

### Transaction

The main entity representing a financial event:

```
Transaction
├── WalletId        → Which wallet/account
├── CategoryId      → Classification (Food, Transport, etc.)
├── Amount          → How much (with currency)
├── Type            → Income/Expense/Transfer
├── Description     → What it was for
├── TransactionDate → When it happened
├── Notes           → Additional details (optional)
├── Location        → Where it happened (optional)
├── Tags            → Custom labels
└── Attachments     → Receipts, invoices
```

### Money (Value Object)

Represents an amount with its currency:

```json
{
  "amount": 150.00,
  "currency": "USD"
}
```

**Supported currencies**: Any ISO 4217 code (USD, EUR, VND, etc.)

### Location (Value Object)

Geographic information:

```json
{
  "latitude": 37.7749,
  "longitude": -122.4194,
  "address": "123 Market St, San Francisco, CA"
}
```

### Recurring Transaction

A template for automatic transaction creation:

```
RecurringTransaction
├── SourceTransactionId → Original transaction template
├── Frequency           → How often (Daily, Weekly, Monthly...)
├── NextOccurrence      → When next instance is due
├── EndDate             → When to stop (optional)
└── IsActive            → Currently running?
```

### Transaction Attachment

Files associated with a transaction:

```
TransactionAttachment
├── FileName       → Original file name
├── FilePath       → Storage location
├── AttachmentType → Receipt, Invoice, Document...
└── FileSize       → Size in bytes
```

## Common Workflows

### Creating a Transaction

1. User initiates transaction creation
2. System validates:
   - Wallet exists
   - Category exists
   - Amount > 0
   - Valid currency
   - Transaction date not in future (optional)
3. Transaction is created with unique ID
4. System returns transaction ID

### Querying Transactions

**By ID**: Direct lookup for single transaction

**By Wallet**: Paginated list for a specific wallet
- Sorted by transaction date (descending)
- Supports pagination (page, pageSize)

### Adding Attachments

1. Transaction must exist
2. File is uploaded and stored
3. Attachment record is created
4. Linked to transaction

## Business Rules

### Amount

- Must be greater than 0
- Currency is required
- Currency code must be valid ISO 4217

### Transaction Date

- Required field
- Can be in the past
- Future dates may be allowed (for scheduled transactions)

### Description

- Required field
- Maximum length: 500 characters

### Tags

- Optional
- Maximum 10 tags per transaction
- Each tag maximum 50 characters

## Data Integrity

### Soft Delete

Transactions are never physically deleted:

```csharp
public bool IsDeleted { get; private set; }
public DateTimeOffset? DeletedAt { get; private set; }
```

### Audit Trail

All transactions track:

- `CreatedAt` - When created
- `CreatedBy` - Who created (future)
- `UpdatedAt` - Last modification
- `UpdatedBy` - Who modified (future)

## Query Patterns

### Get Recent Transactions

```
GET /api/transactions/wallet/{walletId}?pageSize=10
```

### Get Transactions by Date Range

```
GET /api/transactions/wallet/{walletId}?startDate=2025-01-01&endDate=2025-01-31
```
*(Future endpoint)*

### Get Transactions by Category

```
GET /api/transactions/category/{categoryId}
```
*(Future endpoint)*

## Integration Points

### Wallet Service

- Validates wallet ownership
- Updates wallet balance (future)

### Category Service

- Validates category exists
- Provides category details

### Notification Service

- Alerts for large transactions (future)
- Budget warnings (future)

---

**Navigation**: [Explanation Home](../README.md) | [Documentation Map](../../DOCUMENTATION_MAP.md)
