# ADR 006: FastEndpoints Framework

<!-- Generated by Copilot -->

## Status

**Accepted**

## Context

We need to choose an API framework for the TransactionService that:

- Provides a structured approach to endpoint development
- Supports modern .NET features
- Has built-in validation and documentation
- Performs well under load
- Is easy to test

## Decision

We will use **FastEndpoints** as our API framework instead of traditional MVC controllers or raw minimal APIs.

### Why FastEndpoints?

```csharp
public class CreateTransactionEndpoint 
    : Endpoint<CreateTransactionRequest, CreateTransactionResponse>
{
    public override void Configure()
    {
        Post("/api/transactions");
        AllowAnonymous(); // Or use authentication
        Summary(s =>
        {
            s.Summary = "Create a new transaction";
            s.Description = "Creates a new financial transaction";
        });
    }

    public override async Task HandleAsync(
        CreateTransactionRequest req, 
        CancellationToken ct)
    {
        var command = new CreateTransactionCommand(/* map from request */);
        var id = await _mediator.Send(command, ct);
        await SendCreatedAtAsync<GetTransactionByIdEndpoint>(
            new { id }, 
            new CreateTransactionResponse { Id = id }, 
            cancellation: ct);
    }
}
```

### Comparison with Alternatives

| Feature | FastEndpoints | Minimal APIs | MVC Controllers |
|---------|--------------|--------------|-----------------|
| Structure | REPR pattern | Free-form | MVC pattern |
| Performance | Excellent | Excellent | Good |
| Validation | Built-in | Manual | Model binding |
| Swagger | Built-in | Extensions | Swashbuckle |
| Testability | Excellent | Good | Good |
| Learning curve | Low | Low | Medium |

### Key Benefits

1. **REPR Pattern**: Request-Endpoint-Response pattern provides clear structure
2. **Built-in Validation**: FluentValidation integration out of the box
3. **Auto Swagger**: Automatic OpenAPI documentation
4. **Performance**: Near minimal API performance
5. **Testability**: Easy to unit test endpoints

## Consequences

### Positive

- **Consistency**: Every endpoint follows the same pattern
- **Discoverability**: Endpoints are self-documenting
- **Separation**: Clean separation from MediatR handlers
- **Speed**: Fast development with less boilerplate

### Negative

- **Dependency**: Additional framework dependency
- **Learning**: Team needs to learn FastEndpoints conventions
- **Different**: Not the "standard" ASP.NET approach

### Mitigations

- Clear documentation and examples
- Code templates for common patterns
- Team training on conventions

## Configuration

```csharp
// Program.cs
builder.Services.AddFastEndpoints();
builder.Services.SwaggerDocument(o =>
{
    o.DocumentSettings = s =>
    {
        s.Title = "ExpenseVault Transaction Service API";
        s.Version = "v1";
    };
});

app.UseFastEndpoints(c =>
{
    c.Errors.UseProblemDetails();
});
```

## References

- [FastEndpoints Documentation](https://fast-endpoints.com/)
- [REPR Pattern](https://deviq.com/design-patterns/repr-design-pattern)

---

**Navigation**: [Previous: Error Handling](005-centralized-error-handling.md) | [Next: Database Partitioning](007-database-partitioning.md)
