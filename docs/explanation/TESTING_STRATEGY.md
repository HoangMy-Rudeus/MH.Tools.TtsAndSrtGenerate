# Testing Strategy

<!-- Generated by Copilot -->

> Testing approach and methodology for the TransactionService

## Overview

The TransactionService follows a comprehensive testing strategy using the Testing Pyramid approach.

## Testing Pyramid

```
        â•±â•²
       â•±  â•²
      â•± E2Eâ•²         Few, slow, expensive
     â•±â”€â”€â”€â”€â”€â”€â•²
    â•±        â•²
   â•±Integrationâ•²     Some, medium speed
  â•±â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•²
 â•±              â•²
â•±   Unit Tests   â•²   Many, fast, cheap
â•²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•±
```

## Test Types

### Unit Tests

**Location**: `tests/ExpenseVault.TransactionService.Domain.UnitTests/`

**Purpose**: Test domain logic in isolation

**Coverage Target**: 80%+

**Example**:

```csharp
[Fact]
public void Transaction_Create_ShouldSetCorrectProperties()
{
    // Arrange
    var walletId = Guid.NewGuid();
    var categoryId = Guid.NewGuid();
    var amount = new Money(100m, "USD");
    
    // Act
    var transaction = Transaction.Create(
        walletId, categoryId, amount, 
        TransactionType.Expense, "Test", 
        DateTimeOffset.UtcNow);
    
    // Assert
    transaction.WalletId.Should().Be(walletId);
    transaction.Amount.Should().Be(amount);
    transaction.Type.Should().Be(TransactionType.Expense);
}
```

**Patterns**:

- AAA (Arrange, Act, Assert)
- One assertion per test (when practical)
- Descriptive test names

### Integration Tests

**Location**: `tests/ExpenseVault.TransactionService.API.IntegrationTests/`

**Purpose**: Test API endpoints with real database

**Example**:

```csharp
[Fact]
public async Task CreateTransaction_ValidRequest_ReturnsCreated()
{
    // Arrange
    var client = _factory.CreateClient();
    var request = new CreateTransactionRequest { /* ... */ };
    
    // Act
    var response = await client.PostAsJsonAsync("/api/transactions", request);
    
    // Assert
    response.StatusCode.Should().Be(HttpStatusCode.Created);
}
```

**Patterns**:

- WebApplicationFactory for in-memory hosting
- Testcontainers for PostgreSQL
- Clean database per test class

### Application Tests

**Location**: `tests/ExpenseVault.TransactionService.Application.UnitTests/`

**Purpose**: Test command/query handlers

**Example**:

```csharp
[Fact]
public async Task Handle_ValidCommand_CreatesTransaction()
{
    // Arrange
    var mockDbContext = CreateMockDbContext();
    var handler = new CreateTransactionCommandHandler(mockDbContext);
    var command = new CreateTransactionCommand { /* ... */ };
    
    // Act
    var result = await handler.Handle(command, CancellationToken.None);
    
    // Assert
    result.Should().NotBeEmpty();
}
```

## Test Organization

### Naming Convention

```
MethodName_Scenario_ExpectedBehavior
```

Examples:

- `Create_ValidParameters_ReturnsTransaction`
- `Create_NegativeAmount_ThrowsArgumentException`
- `GetById_NonExistentId_ReturnsNull`

### File Structure

```
tests/
â”œâ”€â”€ Domain.UnitTests/
â”‚   â”œâ”€â”€ Entities/
â”‚   â”‚   â”œâ”€â”€ TransactionTests.cs
â”‚   â”‚   â””â”€â”€ RecurringTransactionTests.cs
â”‚   â””â”€â”€ ValueObjects/
â”‚       â”œâ”€â”€ MoneyTests.cs
â”‚       â””â”€â”€ LocationTests.cs
â”‚
â”œâ”€â”€ Application.UnitTests/
â”‚   â””â”€â”€ Features/
â”‚       â””â”€â”€ Transactions/
â”‚           â”œâ”€â”€ CreateTransactionCommandHandlerTests.cs
â”‚           â””â”€â”€ GetTransactionByIdQueryHandlerTests.cs
â”‚
â””â”€â”€ API.IntegrationTests/
    â””â”€â”€ Endpoints/
        â””â”€â”€ Transactions/
            â”œâ”€â”€ CreateTransactionEndpointTests.cs
            â””â”€â”€ GetTransactionByIdEndpointTests.cs
```

## Running Tests

### All Tests

```powershell
dotnet test
```

### Specific Project

```powershell
dotnet test tests/ExpenseVault.TransactionService.Domain.UnitTests
```

### With Coverage

```powershell
dotnet test --collect:"XPlat Code Coverage"
```

### Specific Test

```powershell
dotnet test --filter "FullyQualifiedName~TransactionTests"
```

## Testing Tools

| Tool | Purpose |
|------|---------|
| xUnit | Test framework |
| FluentAssertions | Readable assertions |
| Moq | Mocking framework |
| Testcontainers | Database containers |
| Bogus | Fake data generation |

## Best Practices

### Do

âœ… Test behavior, not implementation

âœ… Use descriptive test names

âœ… Keep tests independent

âœ… Use factories for test data

âœ… Test edge cases

### Don't

âŒ Test private methods directly

âŒ Share state between tests

âŒ Use magic numbers/strings

âŒ Over-mock

âŒ Write flaky tests

## Current Status

| Test Type | Count | Status |
|-----------|-------|--------|
| Domain Unit Tests | 11 | âœ… Passing |
| Application Unit Tests | 0 | ğŸ”œ Planned |
| Integration Tests | 0 | ğŸ”œ Planned |

---

**Navigation**: [Explanation Home](README.md) | [Documentation Map](../DOCUMENTATION_MAP.md)
